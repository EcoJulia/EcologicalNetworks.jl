<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

  <link href="https://use.fontawesome.com/releases/v5.0.2/css/all.css" rel="stylesheet">

  <script src="//code.jquery.com/jquery-latest.min.js"></script>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>EcologicalNetwork.jl - Nestedness significance testing</title>
  <link rel="stylesheet" href="/styles/main.css">
</head>

<body>

  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <!-- <a class="navbar-brand" href="#">
        <img src="/logo.png" alt="">
      </a> -->
      <a class="navbar-brand" href="/">EcologicalNetwork.jl</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Case studies
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="/casestudies/specificity/">Measuring specificity</a>
              <a class="dropdown-item" href="/casestudies/nestedness/">Nestedness significance</a>
              <a class="dropdown-item" href="/casestudies/betadiv/">Network comparison</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Manual
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="dropdown-item" href="/manual/types/">Types</a>
              <a class="dropdown-item" href="/manual/generalities">Generalities</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="/manual/nestedness/">Measuring nestedness</a>
              <a class="dropdown-item" href="/manual/motifs/">Counting motifs</a>
              <a class="dropdown-item" href="/manual/betadiversity/">Network dissimilarity</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="/manual/data/">Datasets</a>
              <a class="dropdown-item" href="/manual/plots/">Network plots</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" href="#">API reference</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container maincontent">
    <h1>Nestedness significance testing</h1>
    <p>The purpose of this case study is to illustrate how we can use the package to
perform significance testing. We will see how we can compare the measured value
of nestedness to random values derived from network permutations.</p>

<p>We start by loading a network, in this case the one by Fonseca &amp; Ganade (1996).
This is a bipartite network.</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">N</span> <span class="o">=</span> <span class="n">fonseca_ganade_1996</span><span class="x">()</span>
</code></pre></div></div>

<p>We will start by getting rid of the quantitative information. This is done by
converting our network to another type:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">M</span> <span class="o">=</span> <span class="nb">convert</span><span class="x">(</span><span class="n">BipartiteNetwork</span><span class="x">,</span> <span class="n">N</span><span class="x">)</span>
</code></pre></div></div>

<p>We will now measure the nestedness of the network, using the $\eta$ measure:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n0</span> <span class="o">=</span> <span class="n">η</span><span class="x">(</span><span class="n">M</span><span class="x">);</span>
</code></pre></div></div>

<p>This returns a dictionary with a value for the rows, the columns, and the entire
network.</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n0</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dict{Symbol,Float64} with 3 entries:
  :rows    =&gt; 0.187648
  :network =&gt; 0.168149
  :columns =&gt; 0.148649
</code></pre></div></div>

<p>At this point, we will need to generate a few random matrices to test our
empirical measure against. We will focus on the Type II null model, in which the
probability of an interaction between two species is proportional to their
relative degrees. We will call this probabilistic template <code class="highlighter-rouge">T</code>:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">T</span> <span class="o">=</span> <span class="n">null2</span><span class="x">(</span><span class="n">M</span><span class="x">)</span>
</code></pre></div></div>

<p>This function will return another network, this time a probabilistic one.</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">typeof</span><span class="x">(</span><span class="n">T</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EcologicalNetwork.BipartiteProbabilisticNetwork{Float64,String}
</code></pre></div></div>

<p>We can draw a random sample based on this template:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rand</span><span class="x">(</span><span class="n">T</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EcologicalNetwork.BipartiteNetwork{String}(Bool[false false … true false;
 false true … false false; … ; false false … false false; false false
 … false false], String["Camponotus balzanii", "Azteca alfari", "Azteca i
sthmica", "Azteca aff. Isthmica", "Allomerus D", "Allomerus prancei", "Allo
merus aff. Octoarticulata", "Solenops A", "Allomerus auripunctata", "Cremat
ogaster B"  …  "Crematogaster A", "Azteca TO", "Crematogaster C", "Azteca
 schummani", "Pseudomyrmex nigrescens", "Pseudomyrmex concolor", "Azteca D"
, "Azteca polymorpha", "Crematogaster E", "Azteca Q"], String["Cecropia pur
puracens", "Cecropia concolor", "Cecropia distachya", "Cecropia ficifolia",
 "Pouruma heterophylla", "Hirtella myrmecophila", "Hirtella physophora", "D
uroia saccifera", "Cordia nodosa", "Cordia aff. Nodosa", "Tococa bullifera"
, "Maieta guianensis", "Maieta poeppiggi", "Tachigali polyphylla", "Tachiga
li myrmecophila", "Amaioua aff. Guianensis"])
</code></pre></div></div>

<p>Of course, we would like to generate a larger sample – so we can draw many
replicates at once:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">random_draws</span> <span class="o">=</span> <span class="n">rand</span><span class="x">(</span><span class="n">T</span><span class="x">,</span> <span class="mi">5000</span><span class="x">)</span>
</code></pre></div></div>

<p>Some of these networks may be <em>degenerate</em>, <em>i.e.</em> they have species without
interactions. It is safer to remove them from our sample:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">valid_draws</span> <span class="o">=</span> <span class="n">filter</span><span class="x">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">isdegenerate</span><span class="x">(</span><span class="n">x</span><span class="x">),</span> <span class="n">random_draws</span><span class="x">)</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: InterruptException:
</pre>

<p>We are left with a smaller number of networks, but all of them have species
with at least one interaction. At this point, we can measure the nestedness
on all of these networks:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_prime</span> <span class="o">=</span> <span class="n">map</span><span class="x">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">η</span><span class="x">(</span><span class="n">x</span><span class="x">)[:</span><span class="n">network</span><span class="x">],</span> <span class="n">valid_draws</span><span class="x">)</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: valid_draws not defined
</pre>

<p>We can also express most of this analysis as a single pipeline:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_prime</span> <span class="o">=</span> <span class="n">N</span> <span class="o">|&gt;</span>
    <span class="c"># Step 1 - remove interaction strength</span>
    <span class="n">n</span> <span class="o">-&gt;</span> <span class="nb">convert</span><span class="x">(</span><span class="n">BipartiteNetwork</span><span class="x">,</span> <span class="n">n</span><span class="x">)</span> <span class="o">|&gt;</span>
    <span class="c"># Step 2 - generate the probability template</span>
    <span class="n">null2</span> <span class="o">|&gt;</span>
    <span class="c"># Step 3 - draw random networks</span>
    <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">rand</span><span class="x">(</span><span class="n">n</span><span class="x">,</span> <span class="mi">40000</span><span class="x">)</span> <span class="o">|&gt;</span>
    <span class="c"># Step 4 - remove degenerate networks</span>
    <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">filter</span><span class="x">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">isdegenerate</span><span class="x">(</span><span class="n">x</span><span class="x">),</span> <span class="n">n</span><span class="x">)</span> <span class="o">.|&gt;</span>
    <span class="c"># Step 5 - measure the nestedness</span>
    <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">η</span><span class="x">(</span><span class="n">n</span><span class="x">)[:</span><span class="n">network</span><span class="x">]</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: InterruptException:
</pre>

<p>This notation is more compact, and can help understand the flow of the analysis
better.</p>

<p>We can now figure out the <em>p</em>-value for this test (specifically, is the network
<em>less</em> nested than expected by chance), by measuring the proportion of randon
draws that are smaller than the empirical value:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="n">sum</span><span class="x">(</span><span class="n">n_prime</span> <span class="o">.&lt;=</span> <span class="n">n0</span><span class="x">[:</span><span class="n">network</span><span class="x">])</span><span class="o">./</span><span class="n">length</span><span class="x">(</span><span class="n">n_prime</span><span class="x">)</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: n_prime not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">println</span><span class="x">(</span><span class="s">"p ≈ </span><span class="si">$</span><span class="s">(round(p,3)), n = </span><span class="si">$</span><span class="s">(length(n_prime))
the network is </span><span class="si">$</span><span class="s">(p &lt; 0.05 ? "</span><span class="n">less</span> <span class="n">nested</span> <span class="n">than</span><span class="s">" : "</span><span class="n">as</span> <span class="n">nested</span> <span class="n">as</span><span class="s">") expected by chance."</span><span class="x">)</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: p not defined
</pre>

<p>Take note that the number of random draws used for this example (&lt;pre class="julia-error"&gt;
ERROR: UndefVarError: n_prime not defined
&lt;/pre&gt;
) is <strong>not enough</strong> in most cases. Aim for anything above 10000.
Finally, we can also look at the distribution of these values (all of this code
is intended to make the final plot more palatable):</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">low</span><span class="x">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">quantile</span><span class="x">(</span><span class="n">n_prime</span><span class="x">,</span> <span class="x">[</span><span class="mf">0.05</span><span class="x">,</span> <span class="mf">0.95</span><span class="x">])</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: n_prime not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rectangle</span><span class="x">(</span><span class="n">w</span><span class="x">,</span> <span class="n">h</span><span class="x">,</span> <span class="n">x</span><span class="x">,</span> <span class="n">y</span><span class="x">)</span> <span class="o">=</span> <span class="n">Shape</span><span class="x">(</span><span class="n">x</span> <span class="o">+</span> <span class="x">[</span><span class="mi">0</span><span class="x">,</span><span class="n">w</span><span class="x">,</span><span class="n">w</span><span class="x">,</span><span class="mi">0</span><span class="x">],</span> <span class="n">y</span> <span class="o">+</span> <span class="x">[</span><span class="mi">0</span><span class="x">,</span><span class="mi">0</span><span class="x">,</span><span class="n">h</span><span class="x">,</span><span class="n">h</span><span class="x">])</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">histogram</span><span class="x">(</span><span class="n">n_prime</span><span class="x">,</span> <span class="n">fill</span><span class="o">=</span><span class="x">:</span><span class="n">lightgrey</span><span class="x">,</span> <span class="n">c</span><span class="o">=</span><span class="x">:</span><span class="n">grey</span><span class="x">,</span> <span class="n">lc</span><span class="o">=</span><span class="x">:</span><span class="n">grey</span><span class="x">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="x">,</span> <span class="n">framestyle</span><span class="o">=</span><span class="x">:</span><span class="n">zerolines</span><span class="x">,</span> <span class="n">lab</span><span class="o">=</span><span class="s">"Random draws"</span><span class="x">,</span> <span class="n">size</span><span class="o">=</span><span class="x">(</span><span class="mi">900</span><span class="x">,</span><span class="mi">300</span><span class="x">));</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: histogram not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vline!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="x">[</span><span class="n">n0</span><span class="x">[:</span><span class="n">network</span><span class="x">]],</span> <span class="n">lab</span><span class="o">=</span><span class="s">"Empirical value"</span><span class="x">,</span> <span class="n">c</span><span class="o">=</span><span class="x">:</span><span class="n">black</span><span class="x">,</span> <span class="n">ls</span><span class="o">=</span><span class="x">:</span><span class="n">dot</span><span class="x">);</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: vline&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="n">rectangle</span><span class="x">(</span><span class="n">low</span><span class="x">,</span><span class="mi">120</span><span class="x">,</span><span class="mi">0</span><span class="x">,</span><span class="mi">0</span><span class="x">),</span> <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="x">,</span> <span class="n">c</span><span class="o">=</span><span class="x">:</span><span class="n">orange</span><span class="x">,</span> <span class="n">lab</span><span class="o">=</span><span class="s">"Significance threshold"</span><span class="x">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="x">,</span> <span class="n">lc</span><span class="o">=</span><span class="x">:</span><span class="n">orange</span><span class="x">);</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: plot&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="n">rectangle</span><span class="x">(</span><span class="mf">0.4</span><span class="o">-</span><span class="n">high</span><span class="x">,</span><span class="mi">120</span><span class="x">,</span><span class="n">high</span><span class="x">,</span><span class="mi">0</span><span class="x">),</span> <span class="n">opacity</span><span class="o">=.</span><span class="mi">2</span><span class="x">,</span> <span class="n">c</span><span class="o">=</span><span class="x">:</span><span class="n">orange</span><span class="x">,</span> <span class="n">lab</span><span class="o">=</span><span class="s">""</span><span class="x">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="x">);</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: plot&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">histogram!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="n">n_prime</span><span class="x">,</span> <span class="n">fill</span><span class="o">=</span><span class="x">:</span><span class="n">lightgrey</span><span class="x">,</span> <span class="n">c</span><span class="o">=</span><span class="x">:</span><span class="n">grey</span><span class="x">,</span> <span class="n">lc</span><span class="o">=</span><span class="x">:</span><span class="n">grey</span><span class="x">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="x">,</span> <span class="n">lab</span><span class="o">=</span><span class="s">""</span><span class="x">);</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: histogram&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xaxis!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="x">(</span><span class="mf">0.1</span><span class="x">,</span> <span class="mf">0.4</span><span class="x">));</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: xaxis&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">yaxis!</span><span class="x">(</span><span class="n">pl</span><span class="x">,</span> <span class="x">(</span><span class="mf">0.0</span><span class="x">,</span> <span class="mf">120.0</span><span class="x">));</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: yaxis&#33; not defined
</pre>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pl</span>
</code></pre></div></div>

<pre class="julia-error">
ERROR: UndefVarError: pl not defined
</pre>


  </div>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript">
  $(function () {
    $('[data-toggle="popover"]').popover({html:true})
  })
  $('.popover-dismiss').popover({
    trigger: 'focus'
  })
  </script>
  <script type="text/javascript">

Array.prototype.uav = function()
{
  var n = {},r=[];
  for(var i = 0; i < this.length; i++)
  {
    if (!n[this[i]])
    {
      n[this[i]] = true;
      r.push(this[i]);
    }
  }
  return r;
}

var regexp = /(\[?)(@)(\w+\d{2}\w?)(\]?)/g;

var refs;
jQuery.ajaxSetup({async:false});
gref = function(d) {refs = d; return refs;}
$.getJSON("/references.json", gref);
jQuery.ajaxSetup({async:true});

match = regexp.exec($('.maincontent').text());
while (match != null) {
  var matchedref = match[3];
  var brackets = match[1] == "[";
  var ref = refs.filter(function(a){return a['id'] == matchedref})[0];

  var inline = "";
  inline += ref['author'][0]['family'];
  if (ref['author'].length == 2) {
    inline += " & ";
    inline += ref['author'][1]['family'];
  }
  if (ref['author'].length > 2) {
    inline += " et al.";
  }

  var GOTO = '';
  if (ref['DOI']) {
    var GOTO = "http://dx.doi.org/"+ref['DOI'];
  } else {
    if (ref['URL']) {
      var GOTO = ref['URL'];
    } else {
      var GOTO = "#";
    }
  }

  var pubyear = ref['issued']['date-parts'][0][0];
  reflink = "<a href='" + GOTO + "' title='" + ref['title'] + "' target='_blank' >Read it!</a>";
  btn = '<a tabindex="0" class="biblio-ref" role="button" data-toggle="popover" data-trigger="focus" title="' + inline + ' (' + pubyear + ')" data-content="' + ref['title'] + '<hr />' + reflink + '"><i class="far fa-file-alt"></i></a>';
  pubyear = btn;
  if (brackets) {
    inline = pubyear;
  } else {
    inline = inline + " " + pubyear;
  }


  var new_html = $('.maincontent').html().replace(match[0], inline);
  $('.maincontent').html(function() {return new_html});

  match = regexp.exec($('.maincontent').text());
}

</script>

</body>
</html>
